# Nginx 이미지를 기반으로 함
FROM nginx:alpine

# Nginx 기본 설정 삭제
RUN rm -rf /usr/share/nginx/html/*

# public 폴더의 모든 내용을 Nginx의 서비스 디렉토리로 복사
COPY . /usr/share/nginx/html

# 기본 Nginx 설정 사용, 필요하면 사용자 정의 설정 파일을 추가할 수 있음
# COPY ./nginx.conf /etc/nginx/conf.d/default.conf
# 80번 포트 노출
# 파일 목록 로깅 - 빌드 시 확인 가능
RUN echo "==== /usr/share/nginx/html 디렉토리 파일 목록 ====" && \
    ls -la /usr/share/nginx/html && \
    echo "==== JavaScript 파일 내용 확인 ====" && \
    if [ -f /usr/share/nginx/html/js/search.js ]; then \
        grep "API_BASE_URL\|GEMINI_API_URL" /usr/share/nginx/html/js/search.js; \
    else \
        echo "search.js 파일이 없습니다!"; \
    fi

EXPOSE 80

# Nginx 시작
CMD ["nginx", "-g", "daemon off;"]